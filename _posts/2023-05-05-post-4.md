---
title: '高级金融理论复习'
date: 2023-05-14
permalink: /posts/FinTheory/
tags:
  - Financial Theory
---



[toc]



# 高级金融理论 (下) 


[思维导图点这里](https://chnzhonghongwei.github.io/images/FinTheory/FinTheoryMindMap.html)

## 1. Black-Litterman Model

### 1.1 Black-Litterman Model: 一种实用资产配置指引

#### 1.1.1 背景

- 由均值方差分析, 最优资产配置组合写成: 
  $$
  w=\lambda \Sigma^{-1}(\bar{R}-R_f\textbf{1})\\
  \lambda = \frac{\mu_p-R_f}{E}
  $$
  其中$\,\Sigma\,$是方差协方差矩阵, $\,\bar{R}\,$是期望收益向量, $\,\mu_p\,$是目标收益率, $\,E\equiv(\bar{R}-R_f\textbf{1})'\Sigma^{-1}(\bar{R}-R_f\bf{1})\,$

- 但是现实中，资产组合的权重对于期望超额收益向量$\,\bar{R^e}\,(\bar{R^e}\equiv\bar{R}-R_f\textbf{1})\,$的变动非常敏感, 期望超额收益一般用历史均值来估计

#### 1.1.2 Black-Litterman 方法的直觉

- 由于期望收益不可观测, 难以估计, 最优资产组合的权重特别敏感，原来的方法不可行
- Black和Litterman把关于期望收益的贝叶斯学习引入到了均值方差分析和CAPM结合的框架
  - 他们把CAPM均衡当成中立的参考点
  - 然后再把投资者自己的观点和均衡信息结合
- 权重敏感性问题可以通过这种方式来缓解

#### 1.1.3 Black-Litterman's 中立参照——CAPM

- 计算CAPM下的期望超额收益
  - 首先我们认为市场组合在均衡中被持有
  - 此时的均衡超额收益表示为：$\,\bar{R}^e_{CAPM}=\bar{R}-R_f\textbf{1}\,$
  - 再者，$\,w_m\,$此时被决定
  - 用$\,w_m\,$来反推出均衡期望超额收益表达式如下图：

<img src="https://hwmarkdown.oss-cn-beijing.aliyuncs.com/test/202305090338382.png" alt="image-20230509033802908"  />

### 1.2 引入确定性的投资者观点

- 记一个人的期望超额收益率为$\,\bar{R}^e\,$,这个收益率和均衡情况不一定一样
  - 这些观点因此可以写成一个由$\,K\,$个线性约束组成的关于期望超额收益率的集合：

$$
P'_{K*N}\bar{R}^e_{N*1}=Q_{K*1}
$$

​	其中$\,P\,$是一个$\,N*K\,$的矩阵并且$\,Q\,$是$\,K*1\,$的

- 比如当证券有3个，观点认为第一个资产的期望超额收益会比第二种高1%，第三种资产的期望超额收益会等于5%，那么我们就写成：
  $$
  P=
  \left( 
  \begin{matrix}
    1 & 0 \\
    -1 & 0 \\
    0 & 1 
  \end{matrix}
  \right),
  Q=
  \left( 
  \begin{matrix}
    1\% \\
    5\% 
  \end{matrix}
  \right).
  $$
- 我们假设投资者希望自己的观点”对于CAPM只会造成最小偏移“，因此表达式写成：

$$
\min \frac{1}{2}\left(\bar{R}^e-\bar{R}_{C A P M}^e\right)^{\prime}(\tau \Sigma)^{-1}\left(\bar{R}^e-\bar{R}_{C A P M}^e\right) \text { s.t. } P^{\prime} \bar{R}^e=Q
$$

​	其中$\,\tau\,$是个人对观点的信息精度。

- 对应的解写成：

$$
\bar{R}^e=\bar{R}_{C A P M}^e+\tau \Sigma P\left(P^{\prime} \tau \Sigma P\right)^{-1}\left(Q-P^{\prime} \bar{R}_{C A P M}^e\right)
$$

- 解的过程如下图：

<img src="https://hwmarkdown.oss-cn-beijing.aliyuncs.com/test/202305090410487.png" alt="image-20230509041030041" style="zoom: 67%;" />

- 那么投资者的最优权重是：

$$
w=\theta \Sigma^{-1} \bar{R}^e=\theta\left[\delta_m w_m+\tau P\left(P^{\prime} \tau \Sigma P\right)^{-1}\left(Q-P^{\prime} \bar{R}_{C A P M}^e\right)\right]
$$

​	其中$\,\theta\,$意义上相当于前面均衡里的$\,\lambda\,$

- 市场均衡时，投资者：
  - 当$\,\theta \delta=1\,$，持有市场组合
  - 当$\,\theta \delta<1\,$，更保守，持有部分市场组合
  - 当$\,\theta \delta>1\,$，杠杆持有市场组合
- 注意此时我们假设投资者对他们的信息**完全自信**

### 1.3 不确定性的观点

#### 1.3.1 贝叶斯更新的简介

#### 1.3.2 模型设定

#### 1.3.3 多元正态分布的概率密度方程

#### 1.3.4 收益率的预测分布(predictive distribution)

#### 1.3.5 实际操作的输入和步骤

### 1.4 总结与讨论

## 2. 市场完备性和收益定价方程

### 2.1 市场完备性

#### 2.1.1 证券市场和收益空间
##### 2.1.1.1 证券市场

- 假设证券在第0期被交易, 在第1期获利；
- 假设有$J$种证券和$S$种未来状态；
- 第$j$种证券的收益可以写成向量$x_j=(x_j(1),x_j(2),\dots,x_j(S))$；
- 市场上所有的证券的收益可以写成一个收益矩阵: $X_{J\times S} \equiv (x_1,x_2,\dots,x_J)^\top$, 此时每一行为一个证券, 每一列为一种状态；
- 那么证券在0期的价格向量为$p$, 有$J$个数
- 证券组合的持有用向量$h$来表示, 有$J$个数
- 证券组合的收益是$hX$
- 证券组合的价格是$ph$
- 证券$j$的收益率是$r_j=x_j/p_j$

##### 2.1.1.2 资产张成的空间 (收益空间) 

- 资产张成的空间是市场中交易证券获得的所有可能收益的集合；
- $\mathcal{M}$是由证券收益张成的$\mathcal{R^{S}}$空间的子空间

#### 2.1.2 完备和不完备市场

##### 2.1.2.1 市场完备性的定义

##### 2.1.2.2 状态索求市场

- 未定收益也称为状态索求, 是指对于状态$\,s\,$, 一个只在状态$\,s\,$支付一单位消费的证券
- 如果对于任意自然状态, 未定收益都存在, 那么状态索求市场就是完备的
- 若证券市场完备, 那么可以假设状态索求存在并且通过他们合成了所有的证券

### 2.2 一价定律 (LOOP) 和线性 (收益) 定价方程

- $q(z)\equiv \{k\in R: k=ph\, \text{for some} \,h\, \text{such that}\,z=hX\}$

#### 2.2.1 一价定律和定价方程的线性性质

- 两者等价
- 证明: 
  - 若$\,q\,$线性, 一个$\,z\,$对应一个$\,ph\,$, LOOP自然成立.
  - 若LOOP成立, 两种收益之和对应两个价格之和, 线性得证.


#### 2.2.2 线性均衡定价

##### 2.2.2.1 前提假设

##### 2.2.2.2 均衡资产组合选择

- 均衡的一阶条件写成: 证券价格向量 $p=X\frac{\partial_1u}{\partial_0u}$

##### 2.2.2.3 一般均衡

- 个人资产组合的均衡选择在市场出清条件下应该都不持有证券, $h=0$. 

##### 2.2.2.4 均衡收益定价方程

- <u>定理: 若0期效用严格递增, 那么在均衡中LOOP满足且均衡收益定价方程是线性的</u>
  - 若0期效用函数单调递增, 1期无收益但0期有收益的情况在均衡中存在 (此时就违背了LOOP) , 那么此时也就不是均衡
  - 因此, 在这样的假设下, LOOP在均衡里必然成立 (自然定价函数也是线性的) 


#### 2.2.3 状态价格

- 若证券市场完备且LOOP满足, 则收益定价函数中, 每个“单位状态收益”对应唯一的一个“单位状态价格”, 即$q(e_s)=q_s$
- LOOP也说明收益定价函数$q(\cdot)$的线性
  - 就是说, $q(z)=\sum\limits_{i=1}^{S}z_iq_i=zq$, $z$是持有证券组合的收益 ($z=hX$, $z_i$是状态$i$的持有收益), $q$是状态价格向量
  - 当所有证券的持有量都是1, 定价函数对应的价格就是证券的单价了, 即$q(\bf{1}\cdot X)=\bf{1}\cdot q(X)=p$
- 均衡状态价格: 在状态索求的设定下, 资产组合选择问题均衡的一阶条件就变成了$q=\partial_1u/\partial_0u$

### 2.3 违背一价定律的情况

****

## 3. 无套利和正性

### 3.0 $q,p,X$ 之间的关系

- $q$ 是收益空间到价格空间的映射
- $p$ 是持有量空间到价格空间的映射
- $X$ 是持有空间到收益空间的映射

- $p=Xq$

### 3.1 无套利

#### 3.1.1 套利的定义

- 套利: 存在$\,h\,$使得$\,hX\ge0\,$且$\,ph\le0\,$, 两者至少有一个是严格不等式
- 强套利的两种类型都满足$\,ph<0\,$ 
- 弱套利的定义 (免费彩票) 

#### 3.1.2 无套利的定义

- 无强套利可能还有弱套利

- 无套利说明$\,hX>0\,$且$\,ph>0\,$, 或者$\,hX=0\,$且$\,ph=0\,$ 

##### 3.1.2.1 LOOP和无强套利的关系

- 满足LOOP只能排除Type2的强套利($\,hX=0,ph<0\,$)
- 不能排除Type1和免费彩票
- 所以无强套利说明LOOP成立, 但不能反过来说
- 造成这个关系的原因在于两者对$\,q(\cdot)\,$的性质要求不同: 
  - LOOP等价于定价函数的线性, 但无套利等价于定价函数的线性和严格正性 (Strict Positivity)

- 所以条件强度关系为: 无套利>无强套利>LOOP

##### 3.1.2.2 $X$的左逆和右逆

- $\,X\,$只有是方阵且满秩的时候才有逆



- 非方阵的时候可以有左逆$\,L\,$使得$\,LX=I_s\,$
- 当$\,J\ge S\,$且$\,Rank(X)=S\,$的时候, $\,L\,$存在: 证券数大于等于状态数量且列之间线性独立
- $\,L=(X'X)^{-1}X'\,$
- 左逆存在$\Leftrightarrow$市场完备



- 自然, 右逆$\,R\,$使得$\,XR=I_J\,$
- 当$\,J\le S\,$且$\,Rank(X)=J\,$的时候, $\,R\,$存在: 证券数小于等于状态数量且行之间线性独立
- $\,R=X'(XX')^{-1}\,$
- 右逆存在$\Leftrightarrow$无冗余资产

##### 3.1.2.3 $Rank(X)=J$ 和LOOP的关系

- 无冗余资产说明任何给定收益, 只有唯一一个资产组合能够实现, 并且LOOP自然成立
- $hX=z\rightarrow h=zR=zX'(XX')^{-1}$, 所以一个收益对应一个持有组合, 从而对一唯一一个价格, LOOP成立
- 判断证券市场是否满足无套利: 
  - 一旦看到证券数小于状态数量的时候, 无冗余资产, LOOP直接成立, 所以排除Type2强套利
  - 看收益非负时候的资产组合, 若没有免费彩票和Type1, 则市场上不存在套利机会

#### 3.1.3 无套利的图像表示法

1. 坐标轴分别是两个证券的持有量, 在图中画出收益矩阵$\,X\,$的各个列向量
2. 在原点出分别画出列向量的法线
3. 各个列向量和法线构成的半圆的区域交集就是$\,hX\ge 0\,$的区域
4. 再画出证券价格向量和其法线
5. 若$\,ph\le 0\,$的区域和$\,hX\ge 0\,$的区域的交集只有原点, 则市场内无套利

- 有时候不一定需要价格向量: 当收益交集始终为负, 则肯定不存在套利

### 3.2 收益定价函数$q(\cdot)$的正性

- 正性函数是指每个非负自变量都有一个非负的函数值
- 严格正性就是正自变量对应正函数值, 比如免费彩票就有一个严格正函数值
- <u>命题: 当且仅当无套利时, 收益定价函数是线性且严格正性的</u>
- <u>命题: 当且仅当无强套利时, 收益定价函数是线性且正性的</u>

- 命题证明过程: 

  - 思路很简单: 
    1. 若严格正性, 正收益必正价格, 此时无套利存在, 自然LOOP成立, 定价函数线性
    2. 若无套利且定价函数非严格正性, 无套利➡️LOOP成立➡️定价函数为线性, 此时就存在符合正收益但非正价格的套利情况, 和命题矛盾
  - 证明如下图：
  
  <img src="https://hwmarkdown.oss-cn-beijing.aliyuncs.com/test/202305051624960.png" alt="s8mcub" style="zoom:67%;" />

#### 3.2.1 正的状态价格

- 状态价格的存在前提就是市场完备且LOOP成立 (自然收益定价函数也是线性的) 
- 因此也说明秩为$\,S\,$, 左逆存在
- $q(X)=Xq=p,\,q=Lp=(X'X)^{-1}X'p$
- <u>声明: 若无套利存在, 那么所有状态价格都严格为正 (由定价函数的严格正性和上一行等式易得)</u>
- <u>声明: 若无强套利存在, 那么所有状态价格都非负</u>

### 3.3 总结

- LOOP不满足说明Type2强套利存在
- 无强套利说明LOOP满足
- 无套利比无强套利设定更强
- 无强套利只能说明LOOP, 但不能说明收益定价函数和状态价格的严格正性
- 套利机会能用图像表示出来

## 4. 正性和估值函数(Valuation Functional)

### 4.0 LOOP和无套利的复习

- 见前文

### 4.1 套利和最优资产组合

#### 4.1.1 无套利的充分条件

- 前文已知, 0期边际效用严格单调递增的话, 要使均衡存在, LOOP是必要的, 此处同理
- <u>定理: 如果给定证券价格, 个人的最优资产组合存在, 并且个人效用函数严格递增, 那么均衡时就不存在套利</u>
  - ⚠️注意: 这里就要求两期都是严格递增, 此时能保证更严格的无套利条件成立
  - 证明: 两期效用严格递增其实就是杜绝了$\,hX=0,ph<0\,$或者$\,hX>0,ph=0\,$或者$\,hX>0,ph<0\,$的情况
  - 如果假设中不是严格递增, 无套利结论不成立

##### 4.1.1.1 一个更弱的单调性假设

- <u>定理: 如果给定证券价格, 个人的最优资产组合存在, 并且个人效用函数在0期严格递增, 在1期单调递增, 那么均衡时就不存在强套利</u>
  - 与4.1.1同理, 允许了$\,hX>0,ph=0\,$情况的存在, 所以强套利不存在

#### 4.1.2 最优资产组合存在的充分条件

- <u>定理: 如果在给定的证券价格下不存在套利, 个人消费为正, 就一定存在均衡时的最优资产组合</u>
  - 证明: 
    - 不妨设不存在冗余资产
    - 使用Weierstrass定理 (此定理说明任何在闭且有界集合里的连续函数都有最大值) , 可以充分证明在个人预算集是<u>闭且有界的(compact)</u>情况下存在最优资产组合, 所以就要先证个人预算集闭且有界
    - 个人预算集的界原本写成: 

$$
0\le c_0 \le w_0-ph\\ 
0\le c_1\le w_1+hX
$$

- 证明有界的思路: 只要证明一个序列的任意子序列的极限有界, 就说明原集合有界；定理中消费为正的前提已经规定了左界为0, 要证右边有界 (并不能直接说右边是有界的, 因为$\,h\,$没有规定范围) 

- 反证法: 假设预算集不是有界的, 那么就存在一个无界的预算集可行消费计划序列(unbounded sequence of budget feasible consumption plans)和资产组合$\,\{c^n,h^n\}\,$, 并且lim&#124;&#124;$h^n$&#124;&#124;$\rightarrow \infty \,$. 
- 由于序列是可行消费计划, 所以对于$\,\{c^n,h^n\}\,$有: 

$$
ph^n\le w_0 \\
h^nX\ge -w_1
$$

- 两个式子两边同时除以$\,||h^n||\,$并定义$\,\bar{h}=\frac{h^n}{||h^n||}\,$为给定的一个资产组合, 在无界假设下取极限得: 
$$
p\bar{h}\le 0 (h\ne 0)\\
\bar{h}X\ge 0
$$

- 这种情况就存在套利了, 和原假设矛盾. 因此, 预算集是有界的. 


#### 4.1.3 正性的均衡定价

- <u>定理: 如果效用函数是严格递增, 那么均衡证券价格不存在套利机会. 并且, 均衡收益定价函数是线性且严格正性的.</u>
  - 在均衡设定里, 个人的均衡资产组合按定义就是最优资产组合, 也就是说这个定理印证并总结了前面的命题和定理
- <u>定理: 如果效用函数0期严格递增, 1期单调递增, 那么均衡证券价格不存在强套利机会. 并且, 均衡收益定价函数是线性且正性的.</u>
- 这两个定理就是把第三部分的“无套利和正性的关系”在“已经证明存在的证券市场均衡条件“下重述了一遍. 只要均衡是存在的 (这一点被效用函数的连续性和消费集的有界性保证) , 那么”市场无套利 (被效用函数两期严格递增保证)“ 和 ”定价函数为正性“的关系依旧成立

#### 4.1.4一些讨论

- 金融中无套利假设处于中心地位
- 衍生品估值的分析中, 会根据无套利假设, 通过证券收益来决定衍生品的价格
- 只要要求了无套利, 不用知道效用函数的具体形式就能使分析结果和效用函数关于消费严格递增的假设下的分析结果一致. 
- 所以, 只要强调了无套利, 分析结果就和均衡分析结果一致

### 4.2 估值函数(I)

#### 4.2.1 估值函数的定义 (估值函数和定价函数的区别) 

- 收益定价函数和估值函数的映射不同: 
  - $q:\mathcal{M}\rightarrow \mathcal{R}$
    - 收益只处于收益空间, 处于现实空间外的收益无法处理
  - $Q:\mathcal{R^s}\rightarrow \mathcal{R}$
    - $\,Q\,$在只考虑收益空间$\,\mathcal{M}\,$里的收益的时候和$\,q\,$等价. 
- 估值函数对所有未定权益 (contingent claim, 状态索求) 都有对应函数值
- 我们重点关注严格正性和正性的估值函数
- 在完备市场, 无套利等价于$\,Q\,$的严格正性 (因为$\,Q\,$存在的前提就是市场完备且LOOP成立) 

#### 4.2.2 金融基本定理

- <u>定理: 当且仅当存在一个严格正性的估值函数时, 市场的证券价格可以排除套利机会.</u>
- <u>定理(弱): 当且仅当存在一个正性的估值函数时, 市场的证券价格可以排除强套利机会.</u>
- 证明: 和前面的收益定价函数的证明如出一辙.
- 但是在证明充分性的部分需要把收益空间扩张成整个商品空间, 要实现这个需要extending $\,q\,$ one dimension at a time.

##### 4.2.2.1 充分性证明的步骤

定义状态索求的值有如下的上下界: <font color=grey>可以理解成紧紧卡死$\,q\,$值的邻域</font>
$$
q_u(z)=\min\limits_{h}\{ph:hX\ge z\}\\
q_l(z)=\max\limits_h\{ph:hX\le z\}
$$

若证券价格排除了强套利,那么对于每个$\,z\in\mathcal{M},\,q_u(z)=q_l(z)=q(z)\,$



## 5. 估值函数(II)

### 5.1 复习章节

#### 5.1.1 收益定价函数

#### 5.1.2 套利和正性

#### 5.1.3 估值函数

### 5.2 估值函数的复习

#### 5.2.1 充分性证明的步骤

1. 第一步
2. 第二步
3. 第三步
4. 第四步
5. 第五步

#### 5.2.2 估值函数的唯一性

### 5.3 总结



